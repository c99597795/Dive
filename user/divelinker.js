function DiveLinker(t,e){if(this.iframeName=t,this.loadingStatus=!1,this.initial=!1,this.watermark=!0,this.isComplete=!1,this.isDebug=!1,this.updateOutput=!1,this.diveStatus="init",this.IOList={inValue:[],outValue:[]},this.inputList={},this.outputList={},this.autoShakehand=!0,this.target=document.querySelector("iframe[name="+t+"]"),this.error=null==this.target,this.error)return this.showError();if(this._window=null==this.target?null:this.target.contentWindow,this.bindHandle(),e)for(const t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}DiveLinker.prototype=function(){function t(t){if(!t)return;let e=this;try{let i=t.data.title,s=t.data.data,n=t.data.id;if(e.isDebug&&console.log("title:"+i),e.isDebug&&console.log("data:"+JSON.stringify(s)),!n)return e.shakeHand();if(n!==e._id)return;let o={in_out_attr:function(t){if(e.initial)return;e.inputList={},e.outputList={};let i=e.IOList=t[0];for(let t=0;t<i.inValue.length;t++){const s=i.inValue[t];e.inputList[s.id]=s}for(let t=0;t<i.outValue.length;t++){const s=i.outValue[t];e.outputList[s.id]=s}e.initial=!0},status:function(t){e.loadingStatus=t},r_out_val2:function(t){for(let i=0;i<t.length;i++){const s=t[i];e.outputList[s.id]=s}e.updateOutput=!0},complete:function(t){e.isComplete||(e.isComplete=!0)},sendError:function(t){e.isDebug&&console.log(t)},checkError:function(t){e.isDebug&&console.log(t)},dive_status:function(t){e.isDebug&&console.log(t),e.diveStatus=t},getLog:function(t){e.log=t},getProject:function(t){e.project=t}};return"function"!=typeof o[i]&&console.log("title not support :"+i),o[i](s)}catch(e){console.log("receive IO with error:"+e),console.log(t)}}const e="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=function(){const t=20,i=e.length,s=[];for(let n=0;n<t;n++)s[n]=e.charAt(Math.random()*i);return s.join("")};return{constructor:DiveLinker,post:function(t){if(this.error)return this.showError();this._window.postMessage(t,"*")},showError:function(t){if(t)return console.error(t);console.error(this.defaultErrorMsg)},bind:function(t){let e=this;return function(){return t.apply(e,arguments)}},bindHandle:function(){window.addEventListener("message",this.bind(t),!1)},removeHandle:function(){window.removeEventListener("message",t())},enableBlock:function(t){let e={title:"setBlock",data:t};this.post(e)},fullScreen:function(t){function e(){i&&(i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.msRequestFullscreen&&i.msRequestFullscreen())}let i=t?document.querySelector("iframe[name="+t+"]"):this.target;e()},shakeHand:function(){if(!this.autoShakehand)return;this._id=i();let t={title:"shakeHand",data:this._id};return this.post(t),this._id},get id(){return this._id},set id(t){if(t=t||i(),this._id)return;this._id=t;let e={title:"shakeHand",data:this._id};return this.post(e),this._id},changetTarget:function(t){this.iframeName=t,this.target=document.querySelector("iframe[name="+t+"]"),this.error=null==this.target||this.error,this._window=null==this.target?null:this.target.contentWindow,this.reset()},setInput:function(t,e,i){let s={title:"in_val"};const n=typeof t;switch(n){case"object":s.data={in_data:t};break;case"number":case"string":{let n=[{id:t,value:e,lockIO:i}];s.data={in_data:n}}}return this.post(s)},setInputToParent:function(t,e,i){let s={title:"in_val"};const n=typeof t;switch(n){case"object":s.data={in_data:t};break;case"number":case"string":{let n=[{id:t,value:e,lockIO:i}];s.data={in_data:n}}}return parent.postMessage(s,"*")},setWidth:function(t){t=t?String(t):"100%";let e={title:"setWidth",data:t};return this.post(e)},setHeight:function(t){t=t?String(t):"100%";let e={title:"setHeight",data:t};return this.post(e)},getViewbox:function(){let t={title:"getViewbox"};return this.post(t)},setProject:function(t){let e="https://dive.nutn.edu.tw/Experiment/kaleTestExperiment5.jsp?eid="+t+"&record=false&r="+Date.now();this.target.setAttribute("src",e),this.reset(),this._window=null==this.target?null:this.target.contentWindow,this.error=null==this.target||this.error},getLoadingStatus:function(){let t={title:"getLoadingStatus"};return this.post(t),this.loadingStatus},resize:function(t,e){let i=t||"100%",s=e||"100%",n={title:"resize",data:{w:i,h:s}};return this.post(n)},debug:function(t){this.isDebug=t,t&&console.log("open debug mode. show log"),t||console.log("close debug model.");let e={title:"debug",data:""};return this.post(e)},getIOList:function(){let t={title:"hello",data:""};return this.post(t),this.IOList},getFocus:function(){let t={title:"focus"};this.post(t)},start:function(){let t={title:"start"};this.post(t)},pause:function(){let t={title:"pause"};this.post(t)},stop:function(){let t={title:"stop"};this.post(t)},resume:function(){let t={title:"resume"};this.post(t)},getLog:function(){let t={title:"getLog"};return this.post(t),this.log},getAttr:function(t){return this.outputList[t]?this.outputList[t].value:this.showError("not find attr")},getInputList:function(){return this.inputList},getOutputList:function(){return this.outputList},getOutput:function(){let t={title:"out_val_2"};this.post(t)},checkComplete:function(){return this.isComplete},checkDiveStatus:function(){let t={title:"check_dive_status"};return this.post(t),this.diveStatus},getProject:function(){if(void 0!==this.project)return this.project;let t={title:"getProject"};this.post(t)},getProjectID:function(){try{let t=new URLSearchParams(new URL(this.target.src).search);return t.get("eid")}catch(t){return console.info(t),-1}},reset:function(){this.isDebug=!1,this.loadingStatus=!1,this.initial=!1,this.watermark=!0,this.isComplete=!1,this._id=null,this.updateOutput=!1,this.diveStatus="init",this.IOList={inValue:[],outValue:[]},this.inputList={},this.outputList={},delete this.project}}}();